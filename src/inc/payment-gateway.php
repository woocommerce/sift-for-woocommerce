<?php declare( strict_types=1 );

namespace Sift_For_WooCommerce\Sift_For_WooCommerce;

/**
 * A class representing a payment gateway plugin which normalizes the payment gateway property according to expectations in the Sift API.
 */
class Payment_Gateway extends Sift_Property {

	private string $woo_gateway_id;

	protected static array $valid_sift_slugs = array(
		'$abra',
		'$acapture',
		'$accpet_blue',
		'$adyen',
		'$aeropay',
		'$afex',
		'$affinipay',
		'$affipay',
		'$affirm',
		'$afrivoucher',
		'$afterpay',
		'$airpay',
		'$airwallex',
		'$alipay',
		'$alipay_hk',
		'$allpago',
		'$altapay',
		'$amazon_payments',
		'$ambank_fpx',
		'$amex_checkout',
		'$android_iap',
		'$android_pay',
		'$apg',
		'$aplazo',
		'$apple_iap',
		'$apple_pay',
		'$argus',
		'$asiabill',
		'$astropay',
		'$atome',
		'$atrium',
		'$au_kantan',
		'$authorizenet',
		'$avangate',
		'$balanced',
		'$bancodobrasil',
		'$bancontact',
		'$bancoplural',
		'$banorte',
		'$banrisul',
		'$banwire',
		'$barclays',
		'$bayanpay',
		'$bbcn',
		'$bcb',
		'$beanstream',
		'$belfius',
		'$best_inc',
		'$billdesk',
		'$billpocket',
		'$bitcash',
		'$bitgo',
		'$bitpay',
		'$bizum',
		'$blackhawk',
		'$blik',
		'$blinc',
		'$blockchain',
		'$bluepay',
		'$bluesnap',
		'$bnpparibas',
		'$boacompra',
		'$bob',
		'$boku',
		'$bold',
		'$boletobancario',
		'$boltpay',
		'$bpay',
		'$bradesco',
		'$braintree',
		'$bread',
		'$bridgepay',
		'$brite',
		'$buckaroo',
		'$buckzy',
		'$cadc',
		'$cardconnect',
		'$cardknox',
		'$cashapp',
		'$cashfree',
		'$cashlesso',
		'$cashlib',
		'$catchball',
		'$ccbill',
		'$ccavenue',
		'$ceevo',
		'$cellulant',
		'$cepbank',
		'$chain_commerce',
		'$chase_paymentech',
		'$checkalt',
		'$checkoutcom',
		'$cielo',
		'$circle',
		'$citi',
		'$citizen',
		'$citrus_pay',
		'$clear_junction',
		'$clearbridge',
		'$clearsettle',
		'$clearcommerce',
		'$cleverbridge',
		'$close_brothers',
		'$cloudpayments',
		'$codi',
		'$cofinoga',
		'$coinbase',
		'$coindirect',
		'$coinpayments',
		'$collector',
		'$community_bank_transfer',
		'$commweb',
		'$compropago',
		'$concardis',
		'$conekta',
		'$copo',
		'$credit_union_atlantic',
		'$credorax',
		'$credsystem',
		'$cross_river',
		'$cuentadigital',
		'$culqi',
		'$cybersource',
		'$cryptocapital',
		'$cryptopay',
		'$currencycloud',
		'$customers_bank',
		'$d_barai',
		'$dana',
		'$daopay',
		'$datacash',
		'$dbs_paylah',
		'$dcbank',
		'$decta',
		'$debitway',
		'$deltec',
		'$democracy_engine',
		'$deutsche_bank',
		'$dibs',
		'$digital_river',
		'$digitalpay',
		'$dinero_services',
		'$directa24',
		'$dlocal',
		'$docomo',
		'$doku',
		'$dospara',
		'$dotpay',
		'$dragonpay',
		'$dreftorpay',
		'$dwarkesh',
		'$dwolla',
		'$ebanx',
		'$ecommpay',
		'$ecopayz',
		'$edenred',
		'$edgil_payway',
		'$efecty',
		'$eft',
		'$elavon',
		'$elipa',
		'$emerchantpay',
		'$empcorp',
		'$enets',
		'$epay',
		'$epayeu',
		'$epoch',
		'$epospay',
		'$eprocessing_network',
		'$eps',
		'$esitef',
		'$etana',
		'$euteller',
		'$everypay',
		'$eway',
		'$e_xact',
		'$fastnetwork',
		'$fat_zebra',
		'$fidor',
		'$finix',
		'$finmo',
		'$fintola',
		'$fiserv',
		'$first_atlantic_commerce',
		'$first_data',
		'$flexepin',
		'$flexiti',
		'$fluidpay',
		'$flutterwave',
		'$fpx',
		'$frick',
		'$fxpaygate',
		'$g2apay',
		'$galileo',
		'$gcash',
		'$geoswift',
		'$getnet',
		'$gigadat',
		'$giropay',
		'$globalcollect',
		'$global_payments',
		'$global_payways',
		'$gmo',
		'$gmopg',
		'$gocardless',
		'$gocoin',
		'$google_pay',
		'$google_wallet',
		'$grabpay',
		'$hanmi',
		'$happy_money',
		'$hayhay',
		'$hdfc_fssnet',
		'$heidelpay',
		'$hipay',
		'$humm',
		'$hyperpay',
		'$i2c',
		'$ibok',
		'$ideal',
		'$ifthenpay',
		'$ikajo',
		'$incomm',
		'$incore',
		'$ingenico',
		'$inghomepay',
		'$inovapay',
		'$inovio',
		'$instamojo',
		'$interac',
		'$internetsecure',
		'$interswitch',
		'$intuit_quickbooks_payments',
		'$ipay',
		'$ipay88',
		'$isignthis',
		'$itau',
		'$itelebill',
		'$iugu',
		'$ixopay',
		'$iyzico',
		'$izettle',
		'$jabong',
		'$jatis',
		'$jeton',
		'$jnfx',
		'$juspay',
		'$kakaopay',
		'$kash',
		'$kbc',
		'$kddi',
		'$kevin',
		'$khipu',
		'$klarna',
		'$knet',
		'$komoju',
		'$konbini',
		'$kopay',
		'$korapay',
		'$kushki',
		'$latamgateway',
		'$latampass',
		'$laybuy',
		'$lean',
		'$lemonway',
		'$letzpay',
		'$lifemiles',
		'$limelight',
		'$linepay',
		'$link4pay',
		'$logon',
		'$mada',
		'$mangopay',
		'$mastercard_payment_gateway',
		'$masterpass',
		'$matera',
		'$maxipago',
		'$maxpay',
		'$maybank',
		'$mcb',
		'$meikopay',
		'$mercadopago',
		'$merchant_esolutions',
		'$merpay',
		'$mfs',
		'$midtrans',
		'$minerva',
		'$mirjeh',
		'$mobile_money',
		'$mockpay',
		'$modo',
		'$moip',
		'$mollie',
		'$momopay',
		'$moneris_solutions',
		'$moneygram',
		'$monoova',
		'$moyasar',
		'$mpesa',
		'$muchbetter',
		'$multibanco',
		'$multicaja',
		'$multiplus',
		'$mvb',
		'$mybank',
		'$myfatoorah',
		'$nanaco',
		'$nanoplazo',
		'$naranja',
		'$naverpay',
		'$neosurf',
		'$net_cash',
		'$netbilling',
		'$netregistry',
		'$neteller',
		'$network_for_good',
		'$nhn_kcp',
		'$nicepay',
		'$ngenius',
		'$nmcryptgate',
		'$nmi',
		'$noble',
		'$noon_payments',
		'$nupay',
		'$ocean',
		'$ogone',
		'$okpay',
		'$omcp',
		'$omise',
		'$onebip',
		'$opay',
		'$openpay',
		'$openpaymx',
		'$optile',
		'$optimal_payments',
		'$ovo',
		'$oxxo',
		'$pacypay',
		'$paddle',
		'$pagar_me',
		'$pago_efectivo',
		'$pagoefectivo',
		'$pagofacil',
		'$pagseguro',
		'$paidy',
		'$papara',
		'$paxum',
		'$pay_garden',
		'$pay_zone',
		'$pay4fun',
		'$paybright',
		'$paycase',
		'$paycash',
		'$payco',
		'$paycell',
		'$paydo',
		'$paydoo',
		'$payease',
		'$payeasy',
		'$payeer',
		'$payeezy',
		'$payfast',
		'$payfix',
		'$payflow',
		'$payfort',
		'$paygarden',
		'$paygate',
		'$paygent',
		'$pago24',
		'$pagsmile',
		'$pay2',
		'$payaid',
		'$payfun',
		'$payix',
		'$payjp',
		'$payjunction',
		'$paykun',
		'$paykwik',
		'$paylike',
		'$paymaya',
		'$paymee',
		'$paymentez',
		'$paymentos',
		'$paymentwall',
		'$payment_express',
		'$paymill',
		'$paynl',
		'$payone',
		'$payoneer',
		'$payop',
		'$paypal',
		'$paypal_express',
		'$paypay',
		'$payper',
		'$paypost',
		'$paysafe',
		'$paysafecard',
		'$paysera',
		'$paysimple',
		'$payssion',
		'$paystack',
		'$paystation',
		'$paystrax',
		'$paytabs',
		'$paytm',
		'$paytrace',
		'$paytrail',
		'$paystrust',
		'$paytrust',
		'$payture',
		'$payway',
		'$payu',
		'$payulatam',
		'$payvalida',
		'$payvector',
		'$payza',
		'$payzen',
		'$peach_payments',
		'$pep',
		'$perfect_money',
		'$perla_terminals',
		'$picpay',
		'$pinpayments',
		'$pivotal_payments',
		'$pix',
		'$plaid',
		'$planet_payment',
		'$plugandplay',
		'$poli',
		'$posconnect',
		'$ppro',
		'$primetrust',
		'$princeton_payment_solutions',
		'$prisma',
		'$prismpay',
		'$processing',
		'$przelewy24',
		'$psigate',
		'$pubali_bank',
		'$pulse',
		'$pwmb',
		'$qiwi',
		'$qr_code_bt',
		'$quadpay',
		'$quaife',
		'$quickpay',
		'$quickstream',
		'$quikipay',
		'$raberil',
		'$radial',
		'$railsbank',
		'$rakbank',
		'$rakuten_checkout',
		'$rapid_payments',
		'$rapipago',
		'$rappipay',
		'$rapyd',
		'$ratepay',
		'$ravepay',
		'$razorpay',
		'$rbkmoney',
		'$reach',
		'$recurly',
		'$red_dot_payment',
		'$rede',
		'$redpagos',
		'$redsys',
		'$rewardspay',
		'$rietumu',
		'$ripple',
		'$rocketgate',
		'$safecharge',
		'$safetypay',
		'$safexpay',
		'$sagepay',
		'$saltedge',
		'$samsung_pay',
		'$santander',
		'$sbi',
		'$sbpayments',
		'$secure_trading',
		'$securepay',
		'$securionpay',
		'$sentbe',
		'$sepa',
		'$sermepa',
		'$servipag',
		'$sezzle',
		'$shopify_payments',
		'$sightline',
		'$signature',
		'$signet',
		'$silvergate',
		'$simpaisa',
		'$simplify_commerce',
		'$skrill',
		'$smart2pay',
		'$smartcoin',
		'$smartpayments',
		'$smbc',
		'$snapscan',
		'$sofort',
		'$softbank_matomete',
		'$solanapay',
		'$splash_payments',
		'$splitit',
		'$spotii',
		'$sps_decidir',
		'$square',
		'$starkbank',
		'$starpayment',
		'$stcpay',
		'$sticpay',
		'$stitch',
		'$stone',
		'$stp',
		'$stripe',
		'$surepay',
		'$swedbank',
		'$synapsepay',
		'$tabapay',
		'$tabby',
		'$tamara',
		'$tapcompany',
		'$tdcanada',
		'$telerecargas',
		'$tfm',
		'$tink',
		'$tipalti',
		'$tnspay',
		'$todopago',
		'$toss',
		'$touchngo',
		'$towah',
		'$tpaga',
		'$transact_pro',
		'$transactive',
		'$transactworld',
		'$transfirst',
		'$transpay',
		'$truelayer',
		'$truemoney',
		'$trust',
		'$trustcommerce',
		'$trustly',
		'$trustpay',
		'$tsys_sierra',
		'$tsys_transit',
		'$tu_compra',
		'$twoc2p',
		'$twocheckout',
		'$undostres',
		'$unlimint',
		'$unionpay',
		'$upay',
		'$usa_epay',
		'$usafill',
		'$utrust',
		'$vantiv',
		'$vapulus',
		'$venmo',
		'$veritrans',
		'$versapay',
		'$verve',
		'$vesta',
		'$viabaloto',
		'$vindicia',
		'$vip_preferred',
		'$virtual_card_services',
		'$virtualpay',
		'$visa',
		'$vme',
		'$vogogo',
		'$volt',
		'$vpos',
		'$watchman',
		'$web_money',
		'$webbilling',
		'$webmoney',
		'$webpay',
		'$webpay_oneclick',
		'$wechat',
		'$wepay',
		'$western_union',
		'$wirecard',
		'$worldpay',
		'$worldspan',
		'$wompi',
		'$wp_cnpapi',
		'$wyre',
		'$xendit',
		'$xfers',
		'$xipay',
		'$yandex_money',
		'$yapily',
		'$yapstone',
		'$zapper',
		'$zenrise',
		'$zer0pay',
		'$zeus',
		'$zgold',
		'$zimpler',
		'$zip',
		'$zipmoney',
		'$zoop',
		'$zotapay',
		'$zooz_paymentsos',
		'$zuora',
		'$2c2p',
	);

	/**
	 * Create a class to represent the payment gateway plugin used for an order.
	 *
	 * @param string $woo_gateway_id The payment gateway ID as exposed by the plugin (e.g., the output of \WC_Order->get_payment_method()).
	 * @param \WC_Order $order The WC_Order which uses this gateway. Used to lookup additional information for payment gateway plugins which work with multiple payment gateways.
	 */
	public function __construct( string $woo_gateway_id, \WC_Order $order ) {
		$this->woo_gateway_id = $woo_gateway_id;
		$this->sift_slug      = static::normalize_payment_gateway_string( $this->woo_gateway_id, $order );
	}

	/**
	 * Get the gateway ID as exposed by the payment gateway plugin.
	 *
	 * @return string
	 */
	public function get_woo_gateway_id(): string {
		return $this->woo_gateway_id;
	}

	/**
	 * Normalize the payment gateway ID provided by the payment gateway plugin into a standard string accepted by Sift.
	 *
	 * @param string $gateway_id The payment gateway ID as exposed by the plugin (e.g., the output of \WC_Order->get_payment_method()).
	 * @param \WC_Order $order The WC_Order which uses this gateway. Used to lookup additional information for payment gateway plugins which work with multiple payment gateways.
	 *
	 * @return string|null The normalized payment gateway string if one is available.
	 */
	public static function normalize_payment_gateway_string( string $gateway_id, \WC_Order $order ): ?string {
		if ( 'transact' === strtolower( $gateway_id ) ) {
			$gateway_id = 'woopayments';
		}
		$payment_gateway = apply_filters( sprintf( 'sift_for_woocommerce_%s_payment_gateway_string', $gateway_id ), $order ); // phpcs:ignore WordPress.NamingConventions.PrefixAllGlobals.DynamicHooknameFound
		if ( static::is_valid_sift_slug( $payment_gateway ) ) {
			return $payment_gateway;
		}
		return null;
	}
}
